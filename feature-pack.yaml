# Feature Pack: notepad
# Notepad with CRUD, list view, sharing, and per-user/global scope

name: notepad
title: Notepad
description: Notepad feature pack with CRUD, list view, sharing, and per-user/global scope

# Route definitions - mapped to React components
routes:
  - path: /notepad
    page: List
    roles: []  # Empty = authenticated users only
    authz: { entity: notes, verb: read }
  - path: /notepad/new
    page: Edit
    roles: []
    authz: { entity: notes, verb: write, require_create: true }
  - path: /notepad/[id]
    page: Detail
    roles: []
    authz: { entity: notes, verb: read }
  - path: /notepad/[id]/edit
    page: Edit
    roles: []
    authz: { entity: notes, verb: write }

# Navigation contributions - auto-added to shell sidebar
nav:
  - id: notepad
    label: Notes
    path: /notepad
    icon: FileText
    group: main  # Primary business features
    showWhen: authenticated
    weight: 200  # Primary content near top (lower weight = higher position)

# Notification types this pack can emit
notifications:
  types:
    - id: note_created
      title: Note Created
      icon: FileText
      priority: low
    - id: note_shared
      title: Note Shared
      icon: Share2
      priority: medium

# Schema contributions (Drizzle tables)
# Projects import these into their schema
schema:
  source: src/schema/notepad.ts
  exports: [notes, Note, InsertNote, UpdateNote, noteAcls, NoteAcl, InsertNoteAcl, NOTE_PERMISSIONS]

# API routes - handler-based pattern (recommended)
api:
  routes:
    - path: /api/notepad
      methods: [GET, POST]
      handler: "@hit/feature-pack-notepad/server/api/notepad"
      description: "List notes (GET) or create note (POST)"
    - path: /api/notepad/[id]
      methods: [GET, PUT, DELETE]
      handler: "@hit/feature-pack-notepad/server/api/notepad-id"
      description: "Get, update, or delete a specific note"
    - path: /api/notepad/[id]/share
      methods: [POST, DELETE]
      handler: "@hit/feature-pack-notepad/server/api/share"
      description: "Generate or revoke share link"
    - path: /api/notepad/[id]/acl
      methods: [GET, POST]
      handler: "@hit/feature-pack-notepad/server/api/acl"
      description: "List ACLs (GET) or create ACL entry (POST) for a note"
    - path: /api/notepad/[id]/acl/[aclId]
      methods: [DELETE]
      handler: "@hit/feature-pack-notepad/server/api/acl"
      description: "Delete an ACL entry"

# No module dependencies - runs on project's own database
requires:
  modules: []

# Dependencies on other feature packs
dependencies:
  feature_packs:
    - name: erp-shell-core

# ─────────────────────────────────────────────────────────────────────────────
# PERMISSIONS - Action definitions (for admin-core permissions UI + runtime checks)
# ─────────────────────────────────────────────────────────────────────────────
permissions:
  actions:
    # Scope Policy Tree: Notes (entity) only.
    #
    # This pack has exactly one entity (`notes`), so we intentionally avoid pack-level
    # scope keys like `notepad.read.scope.*` to keep the Security Groups UI clean.
    #
    # Scope modes:
    # - none: deny all access for this verb/entity (hide pages + block APIs)
    # - own: only owned records (based on userId field)
    # - all: ignore scope (read/write/delete everything)
    #
    # These are mutually exclusive per node; the Security Groups UI renders them as dropdowns.
    - key: notepad.notes.read.scope.none
      label: "Notepad Notes Read Scope = None"
      description: "Deny all note read access."
      default_enabled: false
    - key: notepad.notes.read.scope.own
      label: "Notepad Notes Read Scope = Own"
      description: "Read only notes you created."
      default_enabled: false
    - key: notepad.notes.read.scope.all
      label: "Notepad Notes Read Scope = All"
      description: "Read all notes regardless of ownership."
      default_enabled: false

    - key: notepad.notes.write.scope.none
      label: "Notepad Notes Write Scope = None"
      description: "Deny all note write access."
      default_enabled: false
    - key: notepad.notes.write.scope.own
      label: "Notepad Notes Write Scope = Own"
      description: "Edit only notes you created."
      default_enabled: false
    - key: notepad.notes.write.scope.all
      label: "Notepad Notes Write Scope = All"
      description: "Edit notes regardless of ownership."
      default_enabled: false

    - key: notepad.notes.delete.scope.none
      label: "Notepad Notes Delete Scope = None"
      description: "Deny all note delete access."
      default_enabled: false
    - key: notepad.notes.delete.scope.own
      label: "Notepad Notes Delete Scope = Own"
      description: "Delete only notes you created."
      default_enabled: false
    - key: notepad.notes.delete.scope.all
      label: "Notepad Notes Delete Scope = All"
      description: "Delete notes regardless of ownership."
      default_enabled: false

    - key: notepad.notes.create
      label: "Create Note"
      description: "Create a new note."
      default_enabled: true

# Configurable options
config:
  schema:
    scope:
      type: string
      default: per_user
      enum: [per_user, global]
      description: "per_user: each user sees own notes. global: all users see all notes"
    sharing_enabled:
      type: boolean
      default: false
      description: "Enable note sharing via public links"
    allow_rich_text:
      type: boolean
      default: false
      description: "Enable markdown/rich text editing"
    show_timestamps:
      type: boolean
      default: true
      description: "Show created/updated timestamps in list"
    allow_delete:
      type: boolean
      default: true
      description: "Allow users to delete notes"
